<ResourceDictionary
    x:Class="NINA.Plugin.Logviewer.Options"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:lv="clr-namespace:NINA.Plugin.Logviewer">
    <!--
        x:Class="NINA.Plugin.Logviewer.Options"
        xmlns:control="clr-namespace:FilterDataGrid;assembly=FilterDataGrid"
    -->
    <!--    -->
    <!--  This data template will be displayed in N.I.N.A. on the options->plugin tab with the datacontext of the TestPlugin instance  -->
    <!--  In order for this datatemplate to be picked correctly, the key has to follow the naming convention of <IPlugin.Name>_Options -->
    <!--  Furthermore the Resource Dictionary has to be exported via code behind export attributes  -->
    <!--  "NinaPluginLogviewer_Options  -->
    <DataTemplate x:Key="Log Viewer_Options">

        <Grid Margin="6" DataContext="{Binding LogVM}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>
            <DockPanel
                Grid.Row="0"
                Margin="0,6,0,10"
                LastChildFill="False">
                <Button
                    Width="120"
                    Height="20"
                    Margin="6,0,0,0"
                    HorizontalAlignment="left"
                    VerticalAlignment="center"
                    Command="{Binding LoadLatestCommand}"
                    ToolTip="Opens the active log file">
                    Open active log...
                </Button>
                <Button
                    Width="20"
                    Height="20"
                    Margin="8,0,0,0"
                    HorizontalAlignment="Left"
                    VerticalAlignment="Center"
                    Command="{Binding BrowseLogCommand}"
                    ToolTip="File dialog to choose and open log files">
                    <Path
                        Margin="2,10,2,0"
                        Data="{StaticResource DotsSVG}"
                        Fill="{StaticResource ButtonForegroundBrush}"
                        Stretch="Uniform" />
                </Button>
            </DockPanel>
            <DockPanel
                Grid.Row="1"
                Margin="6,6,12,6"
                VerticalAlignment="Center"
                LastChildFill="False">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="95" />
                        <ColumnDefinition Width="150" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <TextBlock
                        Grid.Column="0"
                        HorizontalAlignment="Left"
                        VerticalAlignment="Center"
                        FontWeight="DemiBold"
                        Text="Hide INFO rows" />
                    <CheckBox
                        Grid.Column="1"
                        Margin="0,0,0,0"
                        HorizontalAlignment="left"
                        VerticalAlignment="Center"
                        Content="Hide INFO"
                        IsChecked="{Binding Filters.HideInfo}" />
                    <TextBlock
                        Grid.Column="2"
                        Margin="0,0,0,0"
                        HorizontalAlignment="Left"
                        VerticalAlignment="Center"
                        Text="{Binding SelectedLogPath}" />
                </Grid>
                <!--<ProgressBar
                    Width="120"
                    IsIndeterminate="True"
                    Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibility}}" />-->
            </DockPanel>

            <DataGrid
                Grid.Row="2"
                Height="550"
                AutoGenerateColumns="False"
                CanUserSortColumns="True"
                EnableColumnVirtualization="True"
                EnableRowVirtualization="True"
                IsReadOnly="True"
                ItemsSource="{Binding LogEntriesView}"
                ScrollViewer.CanContentScroll="True"
                ScrollViewer.VerticalScrollBarVisibility="Visible"
                VirtualizingPanel.IsVirtualizing="True"
                VirtualizingPanel.VirtualizationMode="Recycling">

                <DataGrid.RowStyle>
                    <Style TargetType="DataGridRow">
                        <Setter Property="Background" Value="{Binding Background, RelativeSource={RelativeSource AncestorType=Panel}}" />
                        <Setter Property="VerticalAlignment" Value="Center" />
                    </Style>
                </DataGrid.RowStyle>
                <DataGrid.Columns>

                    <DataGridTemplateColumn Width="165" Header="Date">
                        <DataGridTemplateColumn.HeaderTemplate>
                            <DataTemplate>
                                <StackPanel>
                                    <TextBlock
                                        HorizontalAlignment="Center"
                                        FontSize="14"
                                        FontWeight="Bold"
                                        Text="Date" />
                                    <TextBox
                                        Width="160"
                                        Margin="0,3,0,5"
                                        HorizontalAlignment="Center"
                                        Text="{Binding DataContext.Filters.DateFilter, RelativeSource={RelativeSource AncestorType=DataGrid}, UpdateSourceTrigger=PropertyChanged}"
                                        ToolTip="Date Filter - enter min. 2 character" />
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.HeaderTemplate>
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Date, StringFormat=yyyy-MM-dd  HH:mm:ss.ffff}" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTemplateColumn Width="75" Header="Level">
                        <DataGridTemplateColumn.HeaderTemplate>
                            <DataTemplate>
                                <StackPanel>
                                    <TextBlock
                                        HorizontalAlignment="Center"
                                        FontSize="14"
                                        FontWeight="Bold"
                                        Text="Level" />
                                    <TextBox
                                        Width="75"
                                        Margin="0,3,0,5"
                                        HorizontalAlignment="Center"
                                        Text="{Binding DataContext.Filters.LevelFilter, RelativeSource={RelativeSource AncestorType=DataGrid}, UpdateSourceTrigger=PropertyChanged}"
                                        ToolTip="Level Filter - enter min. 2 character" />
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.HeaderTemplate>
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Level}">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Level}" Value="WARNING">
                                                    <Setter Property="Background" Value="{StaticResource NotificationWarningBrush}" />
                                                    <Setter Property="FontWeight" Value="Bold" />
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Level}" Value="ERROR">
                                                    <Setter Property="Background" Value="{StaticResource NotificationErrorBrush}" />
                                                    <Setter Property="FontWeight" Value="Bold" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTemplateColumn Width="150" Header="Source">
                        <DataGridTemplateColumn.HeaderTemplate>
                            <DataTemplate>
                                <StackPanel>
                                    <TextBlock
                                        HorizontalAlignment="Center"
                                        FontSize="14"
                                        FontWeight="Bold"
                                        Text="Source" />
                                    <TextBox
                                        Width="145"
                                        Margin="0,3,0,5"
                                        HorizontalAlignment="Center"
                                        Text="{Binding DataContext.Filters.SourceFilter, RelativeSource={RelativeSource AncestorType=DataGrid}, UpdateSourceTrigger=PropertyChanged}"
                                        ToolTip="Source Filter - enter min. 2 character" />
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.HeaderTemplate>
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Source}" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTemplateColumn Width="150" Header="Member">
                        <DataGridTemplateColumn.HeaderTemplate>
                            <DataTemplate>
                                <StackPanel>
                                    <TextBlock
                                        HorizontalAlignment="Center"
                                        FontSize="14"
                                        FontWeight="Bold"
                                        Text="Member" />
                                    <TextBox
                                        Width="145"
                                        Margin="0,3,0,5"
                                        HorizontalAlignment="Center"
                                        Text="{Binding DataContext.Filters.MemberFilter, RelativeSource={RelativeSource AncestorType=DataGrid}, UpdateSourceTrigger=PropertyChanged}"
                                        ToolTip="Member Filter - enter min. 2 character" />
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.HeaderTemplate>
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Member}" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTemplateColumn Width="*" Header="Message">
                        <DataGridTemplateColumn.HeaderStyle>
                            <Style TargetType="DataGridColumnHeader">
                                <Setter Property="Background" Value="{Binding Background, RelativeSource={RelativeSource AncestorType=DataGrid}}" />
                                <Setter Property="HorizontalContentAlignment" Value="Left" />
                                <Setter Property="VerticalContentAlignment" Value="Center" />
                            </Style>
                        </DataGridTemplateColumn.HeaderStyle>
                        <DataGridTemplateColumn.HeaderTemplate>
                            <DataTemplate>
                                <StackPanel>
                                    <TextBlock
                                        Margin="5,0,0,0"
                                        HorizontalAlignment="left"
                                        FontWeight="Bold"
                                        Text="Message"
                                        TextAlignment="Left" />
                                    <TextBox
                                        Width="200"
                                        Margin="5,3,0,5"
                                        HorizontalAlignment="left"
                                        Text="{Binding DataContext.Filters.MessageFilter, RelativeSource={RelativeSource AncestorType=DataGrid}, UpdateSourceTrigger=PropertyChanged}"
                                        ToolTip="Message Filter - enter min. 2 character" />
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.HeaderTemplate>
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock
                                    Margin="5,0,0,5"
                                    Text="{Binding Message}"
                                    TextAlignment="Left" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Grid>
    </DataTemplate>
</ResourceDictionary>